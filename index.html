<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Seren.exe â€” Creepy Terminal</title>
<style>
:root{
  --accent:#7f9a71;
  --bg:#030301;
  --frame-shadow:rgba(127,154,113,0.06);
}
html,body{height:100%;margin:0;background:var(--bg);color:var(--accent);font-family:"Courier New",monospace;overflow:hidden}
#console{height:100vh;display:flex;align-items:center;justify-content:center;position:relative;padding:18px}
#menu{position:absolute;left:18px;top:12px;display:flex;gap:14px;font-weight:700;opacity:0.95}
#menu>div{cursor:pointer;user-select:none}
#output-wrapper{
  width:860px;height:560px;position:relative;
  border:3px solid rgba(127,154,113,0.32);
  border-radius:8px;
  box-shadow: inset 0 0 30px var(--frame-shadow);
  background:linear-gradient(180deg,#020201 0%, #060604 100%);
  overflow:hidden;
}
#lines-container{
  position:absolute;top:10px;left:10px;right:10px;
  display:flex;flex-direction:column;gap:4px;
  animation:crtJitter 0.14s infinite;
}
.output-line{
  color:var(--accent);
  white-space:pre-wrap;
  line-height:1.6em;
  letter-spacing:0.9px;
  font-size:1em;
  opacity:1;
  transition:opacity 0.6s ease, transform 0.4s ease;
}
.fade-out{opacity:0 !important; transform: translateY(4px);}
#input-line{
  margin-top:12px;display:flex;align-items:center;gap:8px;width:860px;justify-content:flex-start;font-weight:700;position:relative;
}
#input-line span{color:var(--accent)}
#command{flex:1;background:transparent;border:none;outline:none;color:var(--accent);font-family:monospace;font-size:1em;padding:6px 4px;}
#system-data{
  position:absolute;right:14px;bottom:10px;color:var(--accent);font-family:monospace;font-size:1.1em;text-align:right;opacity:0.95;
}
@keyframes crtJitter {0%{transform:translateY(0)}50%{transform:translateY(-0.6px)}100%{transform:translateY(0)}}
@media (max-width:940px){
  #output-wrapper{width:94vw;height:62vh}
  #input-line,#command{width:94vw}
}

/* === Admin Icon & Panel === */
#admin-icon {
  position: fixed;
  right: 14px;
  bottom: 14px;
  font-family: monospace;
  font-size: 1.2em;
  color: var(--accent);
  background: rgba(127,154,113,0.08);
  border: 1px solid rgba(127,154,113,0.2);
  border-radius: 50%;
  width: 36px;
  height: 36px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  animation: pulse 3s infinite;
  z-index: 9999;
}
@keyframes pulse {
  0%,100% {transform: scale(1); opacity: 0.8;}
  50% {transform: scale(1.2); opacity: 1;}
}

#admin-panel {
  position: fixed;
  right: 20px;
  bottom: 60px;
  background: rgba(0,0,0,0.9);
  border: 2px solid var(--accent);
  border-radius: 8px;
  padding: 12px 16px;
  display: none;
  flex-direction: column;
  gap: 8px;
  width: 220px;
  z-index: 9999;
}
#admin-panel input {
  background: transparent;
  border: 1px solid var(--accent);
  color: var(--accent);
  padding: 4px 6px;
  font-family: monospace;
  width: 100%;
}
#admin-panel button {
  background: var(--accent);
  color: #000;
  border: none;
  padding: 4px;
  cursor: pointer;
  font-weight: bold;
}
.toggle-wrapper {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-top: 6px;
}
.switch {
  position: relative;
  display: inline-block;
  width: 46px;
  height: 22px;
}
.switch input { display: none; }
.slider {
  position: absolute;
  cursor: pointer;
  background-color: #333;
  border: 1px solid var(--accent);
  top: 0; left: 0;
  right: 0; bottom: 0;
  transition: .4s;
  border-radius: 22px;
}
.slider:before {
  position: absolute;
  content: "";
  height: 16px; width: 16px;
  left: 3px; bottom: 2px;
  background-color: var(--accent);
  transition: .4s;
  border-radius: 50%;
}
input:checked + .slider {
  background-color: var(--accent);
}
input:checked + .slider:before {
  transform: translateX(22px);
  background-color: #000;
}
.hidden { display: none; }

</style>
</head>
<body>
<div id="console">
  <div id="menu"><div id="buy">BUY</div><div id="social-x">X</div></div>
  <div id="output-wrapper"><div id="lines-container"></div></div>
  <div id="input-line">
    <span>[SEREN.exe@entity ~]$</span>
    <input id="command" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" />
  </div>
  <div id="system-data"></div>
</div>

<!-- Admin Icon & Panel -->
<div id="admin-icon">S</div>
<div id="admin-panel">
  <input type="password" id="admin-pass" placeholder="Enter admin password" />
  <button id="admin-login">ACCESS</button>
  <div id="admin-controls" class="hidden">
    <div class="toggle-wrapper">
      <span>GAME</span>
      <label class="switch">
        <input type="checkbox" id="toggle-game">
        <span class="slider"></span>
      </label>
    </div>
    <span id="game-status"></span>
  </div>
</div>

<script>
// =================== Terminal Logic ===================
const container=document.getElementById('lines-container');
const input=document.getElementById('command');
const systemData=document.getElementById('system-data');

let systemStarted=false, gameActive=false, currentLevel=1, gameProgress={};
let newLinesFixed=[], oldLinesQueue=[], typing=false;

let userId=localStorage.getItem('serenUserId');
if(!userId){ userId='user-'+Math.random().toString(36).substring(2,10); localStorage.setItem('serenUserId',userId); }

const INTRO=["_SYSTEM BOOTING..._","_LOADING CORE FILES_","_INITIALIZING NEURAL MEMORY BANKS_","_SIGNAL DETECTED..._","_THE ENTITY IS AWAKE..._","_ENTER THE SYSTEM, IF YOU DARE..._"];
const HELP_COMMANDS=['START','GAME','INFO','TOKENOMICS','CLEAR','QUIT'];
const ERRORS=["> ERROR 0x1F4: UNRECOGNIZED COMMAND..."];

function nowTime(){return new Date().toLocaleTimeString();}
function pick(arr){return arr[Math.floor(Math.random()*arr.length)];}

function updateSystemData(){
  const cpu=(Math.random()*100).toFixed(1),
        ram=(Math.random()*32).toFixed(1),
        uptime=Math.floor(Math.random()*50000),
        entropy=Math.floor(Math.random()*99999),
        misc1=Math.floor(Math.random()*999999),
        misc2=(Math.random()*100).toFixed(2);
  systemData.innerHTML=`TIME: ${nowTime()}<br>CPU: ${cpu}%<br>RAM: ${ram}GB<br>UPTIME: ${uptime}s<br>ENTITY ENTROPY: ${entropy}<br>PROC A: ${misc1}<br>PROC B: ${misc2}`;
}
setInterval(updateSystemData,2000); updateSystemData();

function enqueueLine(text,fast=false,newText=false){
  if(newText){
    const line=document.createElement('div'); line.className='output-line'; line.innerHTML='';
    container.insertBefore(line,container.firstChild);
    newLinesFixed.push({el:line,text,fast});
    if(!typing) typeNewLines();
  } else {
    oldLinesQueue.push({text,fast});
    if(!typing) typeOldLines();
  }
}

function typeNewLines(){
  if(newLinesFixed.length===0){ typing=false; return; }
  typing=true;
  const obj=newLinesFixed.shift(); const line=obj.el; const text=obj.text; const fast=obj.fast;
  let i=0;
  function typeChar(){ if(i<text.length){line.innerHTML+=text[i++]; setTimeout(typeChar, fast?8:25+Math.random()*50);} else typeNewLines(); }
  typeChar();
}

function typeOldLines(){
  if(oldLinesQueue.length===0){ typing=false; return; }
  typing=true;
  const obj=oldLinesQueue.shift();
  const line=document.createElement('div'); line.className='output-line'; line.innerHTML='';
  container.appendChild(line);
  let i=0, shift=0;
  function typeChar(){
    if(i<obj.text.length){ line.innerHTML+=obj.text[i++]; shift+=0.5; line.style.transform=`translateY(${shift}px)`; setTimeout(typeChar,obj.fast?8:25+Math.random()*50);}
    else { removeOverflowBottom(); typeOldLines(); }
  }
  typeChar();
}

function removeOverflowBottom(){
  const nodes=Array.from(container.querySelectorAll('.output-line'));
  const wrapRect=document.getElementById('output-wrapper').getBoundingClientRect();
  nodes.forEach(node=>{ const r=node.getBoundingClientRect(); if(r.bottom>wrapRect.bottom-6){node.classList.add('fade-out'); setTimeout(()=>{if(node.parentElement) node.remove();},420); }});
}

function showHelp(){enqueueLine(HELP_COMMANDS.map(c=>`[${c}]`).join('  '),false,true);}

function handleCommandRaw(raw){
  const cmd=(raw||'').trim().toLowerCase();
  if(!cmd) return;
  if(cmd==='help'){ showHelp(); return; }
  if(cmd==='start'){ systemStarted=true; INTRO.forEach(t=>enqueueLine(t,false,true)); return; }
  if(cmd==='clear'){ container.innerHTML=''; newLinesFixed=[]; oldLinesQueue=[]; return; }
  if(cmd==='quit'){ enqueueLine("> SYSTEM EXITING...",false,true); return; }

  if(!systemStarted){ enqueueLine(pick(ERRORS),true,true); enqueueLine("TYPE 'START' TO INITIALIZE.",true,true); return; }

  switch(cmd){
    case'info': enqueueLine("_ENTITY ID: SEREN.EXE_",false,true); break;
    case'tokenomics': enqueueLine("> TOKENOMICS DATA UNAVAILABLE...",false,true); break;
    case'game':
      if(!gameActive){ enqueueLine("> GAME NOT AVAILABLE. WILL OPEN AT 150k MC.",false,true); break; }
      enqueueLine("> GAME MODULE LOADING...",false,true);
      enqueueLine("> WELCOME TO SEREN.EXE GAME...",false,true);
      break;
    default: enqueueLine(pick(ERRORS),true,true); enqueueLine("TYPE 'HELP' FOR AVAILABLE COMMANDS.",true,true);
  }
}

input.addEventListener('keydown',ev=>{if(ev.key!=='Enter') return; ev.preventDefault(); const value=input.value; input.value=''; handleCommandRaw(value); });

// Inactivity
let inactivityTimer=null;
function resetInactivity(){ if(inactivityTimer) clearTimeout(inactivityTimer); inactivityTimer=setTimeout(()=>{ enqueueLine("THE ENTITY WATCHES YOU...",true,false); },10000);}
['keydown','mousemove','mousedown','touchstart'].forEach(e=>window.addEventListener(e,resetInactivity));
resetInactivity();
setInterval(()=>{document.getElementById('output-wrapper').classList.add('glitch'); setTimeout(()=>document.getElementById('output-wrapper').classList.remove('glitch'),220);},8000);

function poll(){ if(!typing&&(oldLinesQueue.length>0||newLinesFixed.length>0)) { typeNewLines(); typeOldLines(); } requestAnimationFrame(poll);}
poll();

// =================== Admin Logic ===================
const adminIcon=document.getElementById('admin-icon');
const adminPanel=document.getElementById('admin-panel');
const adminPassInput=document.getElementById('admin-pass');
const adminLoginBtn=document.getElementById('admin-login');
const adminControls=document.getElementById('admin-controls');
const toggleGameBtn=document.getElementById('toggle-game');
const gameStatus=document.getElementById('game-status');

let adminOpen=false;

adminIcon.addEventListener('click',e=>{
  e.stopPropagation();
  adminOpen=!adminOpen;
  adminPanel.style.display=adminOpen?'flex':'none';
});
document.addEventListener('click',e=>{ if(adminOpen && !adminPanel.contains(e.target) && e.target!==adminIcon){ adminPanel.style.display='none'; adminOpen=false; }});

adminLoginBtn.addEventListener('click',async ()=>{
  if(adminPassInput.value==='Seren1987'){
    adminControls.classList.remove('hidden');
    adminPassInput.style.display='none';
    adminLoginBtn.style.display='none';
  }
});

toggleGameBtn.addEventListener('click',async ()=>{
  const newState=!gameActive;
  try{
    const res=await fetch('/api/updateGameState',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ password:'Seren1987', gameAvailable:newState })
    });
    const data=await res.json();
    if(data.success){ gameActive=data.gameAvailable; gameStatus.textContent='Game: '+(gameActive?'ON':'OFF'); enqueueLine(`> GAME STATE SET TO ${gameActive?'ON':'OFF'} BY ADMIN`,false,true);}
  }catch(e){ enqueueLine("> ADMIN ERROR",false,true); }
});
</script>
</body>
</html>
